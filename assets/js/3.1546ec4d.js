(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{624:function(s,t,a){s.exports=a.p+"assets/img/image-20210405182745430.cad7d559.png"},625:function(s,t,a){s.exports=a.p+"assets/img/image-20210405183122596.a6d0a974.png"},626:function(s,t,a){s.exports=a.p+"assets/img/image-20210405183223678.a10aeee9.png"},627:function(s,t,a){s.exports=a.p+"assets/img/image-20210405183658650.d303532d.png"},628:function(s,t,a){s.exports=a.p+"assets/img/image-20210405184001160.aee8ad8d.png"},629:function(s,t,a){s.exports=a.p+"assets/img/image-20210405184246575.58df4546.png"},630:function(s,t,a){s.exports=a.p+"assets/img/image-20210405184428954.18103f95.png"},631:function(s,t,a){s.exports=a.p+"assets/img/image-20210405185534739.61f940b3.png"},632:function(s,t,a){s.exports=a.p+"assets/img/image-20210405185827558.7ed1be5b.png"},633:function(s,t,a){s.exports=a.p+"assets/img/image-20210405185847333.2a8a56f2.png"},634:function(s,t,a){s.exports=a.p+"assets/img/image-20210405185919163.a6b6efa3.png"},635:function(s,t,a){s.exports=a.p+"assets/img/image-20210405192417652.ac2311a7.png"},636:function(s,t,a){s.exports=a.p+"assets/img/image-20210405194430273.6caba7f6.png"},787:function(s,t,a){"use strict";a.r(t);var n=a(13),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"jmeter-测试单节点与集群的并发异常"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jmeter-测试单节点与集群的并发异常"}},[s._v("#")]),s._v(" JMeter 测试单节点与集群的并发异常")]),s._v(" "),n("p",[s._v("可以在 "),n("a",{attrs:{href:"https://jmeter.apache.org/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("JMeter"),n("OutboundLink")],1),s._v(" 官方下载 "),n("a",{attrs:{href:"https://mirrors.tuna.tsinghua.edu.cn/apache//jmeter/binaries/apache-jmeter-5.4.1.zip",target:"_blank",rel:"noopener noreferrer"}},[s._v("apache-jmeter-5.4.1.zip"),n("OutboundLink")],1),s._v("，解压之后在 "),n("code",[s._v("bin")]),s._v(" 目录下有启动文件：")]),s._v(" "),n("ul",[n("li",[s._v("Mac："),n("code",[s._v("jmeter")])]),s._v(" "),n("li",[s._v("Win："),n("code",[s._v("jmeter.bat")])])]),s._v(" "),n("h2",{attrs:{id:"单节点测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单节点测试"}},[s._v("#")]),s._v(" 单节点测试")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("创建线程组与取样器")]),s._v(" "),n("p",[s._v("设置使用多少个线程来做什么事情")]),s._v(" "),n("p",[s._v("先创建一个计划，名称定义为 「单个 tomcat 测试」保存后，再添加线程组，如下图所示")]),s._v(" "),n("p",[n("img",{attrs:{src:a(624),alt:"image-20210405182745430"}})]),s._v(" "),n("p",[s._v("设置 "),n("strong",[s._v("线程组")]),s._v(" 相关信息")]),s._v(" "),n("p",[n("img",{attrs:{src:a(625),alt:"image-20210405183122596"}})]),s._v(" "),n("p",[s._v("再在该线程组上添加 "),n("strong",[s._v("取样器")]),s._v("，选择 HTTP 请求")]),s._v(" "),n("p",[n("img",{attrs:{src:a(626),alt:"image-20210405183223678"}})]),s._v(" "),n("p",[s._v("填写要测试的 tomcat 节点信息，如图所示，我们这里没有填写路径，就是直接请求 "),n("code",[s._v("http://192.168.56.107:8080/")]),s._v(" 这个地址。另外下面还有参数等信息可以填写")]),s._v(" "),n("p",[n("img",{attrs:{src:a(627),alt:"image-20210405183658650"}})])]),s._v(" "),n("li",[n("p",[s._v("创建监听器")]),s._v(" "),n("p",[s._v("也就是线程组执行的结果信息如何显示")]),s._v(" "),n("p",[s._v("在执行计划上面右键打开添加导航")]),s._v(" "),n("p",[n("img",{attrs:{src:a(628),alt:"image-20210405184001160"}})]),s._v(" "),n("p",[s._v("下面我们先添加三个监听器：聚合报告、查看结果树、用表格查看结果")])]),s._v(" "),n("li",[n("p",[s._v("启动测试")]),s._v(" "),n("p",[n("img",{attrs:{src:a(629),alt:"image-20210405184246575"}})])])]),s._v(" "),n("p",[s._v("点击启动之后，就可以查看报告了，在执行过程中也可以查看报告，不过报告的数据会实时变化")]),s._v(" "),n("p",[n("img",{attrs:{src:a(630),alt:"image-20210405184428954"}})]),s._v(" "),n("ul",[n("li",[n("p",[s._v("样本：总的请求次数")])]),s._v(" "),n("li",[n("p",[s._v("品均值：平均响应时间，单位是毫秒")])]),s._v(" "),n("li",[n("p",[s._v("中位数：50% 的请求在 29 毫秒")]),s._v(" "),n("p",[s._v("意思是，在 5000 次请求里面，有 "),n("code",[s._v("5000 * 50% = 2500")]),s._v(" 次请求是 29 毫秒内响应，那么另外 50% 的请求会大于 29 毫秒")])]),s._v(" "),n("li",[n("p",[s._v("其余的 90%、95%、99%：以此类图")])]),s._v(" "),n("li",[n("p",[s._v("最大、最小值：耗时最小最大的时间是多少毫秒")])]),s._v(" "),n("li",[n("p",[s._v("异常%：异常请求占比，这里对于 50 个并发的请求，tomcat 能处理过来，没有出现异常")])]),s._v(" "),n("li",[n("p",[s._v("吞吐量：意思是每秒可以处理 900+ 的请求")])]),s._v(" "),n("li",[n("p",[s._v("接收 KB/sec：每秒接收多少 KB 的数据，这个与网络带宽有关，现在我们是在本地测试的，所以很高")])])]),s._v(" "),n("p",[s._v("调整线程数量到 200 后，再次测试，在测试前要点击那个黄色扫帚按钮，先清除结果")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/image-20210405185351571.png",alt:"./image-20210405185351571"}})]),s._v(" "),n("p",[n("img",{attrs:{src:a(631),alt:"image-20210405185534739"}})]),s._v(" "),n("p",[s._v("还是正常的，那么笔者这里把线程数量加到了 1000 发现有错误的了，如下图所示")]),s._v(" "),n("p",[n("img",{attrs:{src:a(632),alt:"image-20210405185827558"}})]),s._v(" "),n("p",[n("img",{attrs:{src:a(633),alt:"image-20210405185847333"}})]),s._v(" "),n("p",[s._v("能看到具体的错误结果是什么")]),s._v(" "),n("p",[n("img",{attrs:{src:a(634),alt:"image-20210405185919163"}})]),s._v(" "),n("h2",{attrs:{id:"集群测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#集群测试"}},[s._v("#")]),s._v(" 集群测试")]),s._v(" "),n("p",[s._v("我们在另外一台机器上再启动一个 tomcat，这里可以直接将当前的 tomcat 复制过去")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study local"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scp -r ./tomcat-api/ root@192.168.56.108:/usr/local/")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("那么下面使用 Nginx 来配置 tomcat 集群")]),s._v(" "),n("div",{staticClass:"language-lua line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-lua"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" 修改为了 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 个 worker\nworker_processes  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("events")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    worker_connections  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("http")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("....")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" 配置上游服务器\n    upstream "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tomcats")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".107")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".108")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n           "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" 转发到上游服务器\n           proxy_pass    http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("tomcats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("p",[s._v("JMeter 是可以启动多个的，所有另外启动一个来测试集群的。下面笔者重新按照 1000 的并发数量测试了单个 tomcat 测试（笔者的电脑上，只有线程达到 1000 的时候才会出现异常）")]),s._v(" "),n("p",[n("img",{attrs:{src:a(635),alt:"image-20210405192417652"}})]),s._v(" "),n("p",[s._v("集群的测试结果")]),s._v(" "),n("p",[n("img",{attrs:{src:a(636),alt:"image-20210405194430273"}})]),s._v(" "),n("p",[s._v("在上面的报告中，其他的耗时并不能表现出真实的状况，因为所有服务器都是在我宿主机上的，着重需要看的是 "),n("strong",[s._v("异常占比")])]),s._v(" "),n("ul",[n("li",[s._v("单机异常：0.14%，140 个异常")]),s._v(" "),n("li",[s._v("集群异常：0.02%，20 个异常")])]),s._v(" "),n("p",[s._v("一般来说某些企业的异常临界点是 20%，比如超过 20% 就需要扩容了。")])])}),[],!1,null,null,null);t.default=e.exports}}]);